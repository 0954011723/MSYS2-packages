# Maintainer: Martell Malone <alexpux@gmail.com>

pkgname=busybox
pkgver=1.22.1
pkgrel=1
pkgdesc="BusyBox: The Swiss Army Knife of Embedded Linux"
arch=('i686' 'x86_64')
url="http://gondor.apana.org.au/~herbert/dash/"
license=('GPL2')
depends=('msys2-base' 'msys2-runtime')
groups=('base')
install=busybox.install
source=("http://busybox.net/downloads/${pkgname}-${pkgver}.tar.bz2"
        "busybox-cygwin.patch"
        "fixsyscalls.patch"
        "msys2.config")

sha1sums=('SKIP'
          'SKIP'
          'SKIP'
          'SKIP')

prepare() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  patch -p1 -i ${srcdir}/busybox-cygwin.patch
  patch -p1 -i ${srcdir}/fixsyscalls.patch
  cp ${srcdir}/msys2.config ${srcdir}/${pkgname}-${pkgver}/.config
}

build() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  #make oldconfig      
  CFLAGS='-O2 -static-libgcc' make
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  
  #install busybox
  mkdir -p ${pkgdir}/usr/bin
  cp ${srcdir}/${pkgname}-${pkgver}/busybox.exe ${pkgdir}/usr/bin

  # license
  install -m644 -D LICENSE ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
}
