From a65c29fd2dff7e822ab6b4dcba24853041174146 Mon Sep 17 00:00:00 2001
From: mintty <mintty@users.noreply.github.com>
Date: Sun, 5 Jul 2015 19:22:32 +0200
Subject: [PATCH] hotfix Alt-F2

---
 src/appinfo.h     | 2 +-
 src/child.c       | 12 ++++++++++--
 src/winmain.c     |  7 +++++++
 wiki/Changelog.md |  3 +++
 4 files changed, 21 insertions(+), 3 deletions(-)

diff --git a/src/child.c b/src/child.c
index f3d37b7..494faa1 100644
--- a/src/child.c
+++ b/src/child.c
@@ -486,12 +486,13 @@ child_fork(int argc, char *argv[])
     close(win_fd);
 
     // add child parameters
-    int newparams = 4;
+    int newparams = 0;
     char * * newargv = malloc((argc + newparams + 1) * sizeof(char *));
     int i = 0, j = 0;
     int addnew = 1;
     while (1) {
-      if (addnew && (! argv[i] || strcmp (argv[i], "-e") == 0)) {
+      // hotfix, clean up later
+      if (0 && addnew && (! argv[i] || strcmp (argv[i], "-e") == 0)) {
         addnew = 0;
         // insert additional parameters here
         newargv[j++] = "-o";
@@ -510,6 +511,13 @@ child_fork(int argc, char *argv[])
       j++;
     }
 
+    char parbuf1[34];
+    sprintf (parbuf1, "MINTTY_ROWS=%d", term.rows);
+    putenv (parbuf1);
+    char parbuf2[34];
+    sprintf (parbuf2, "MINTTY_COLS=%d", term.cols);
+    putenv (parbuf2);
+
 #if CYGWIN_VERSION_DLL_MAJOR >= 1005
     execv("/proc/self/exe", newargv);
 #else
diff --git a/src/winmain.c b/src/winmain.c
index dedef7f..95a23f4 100644
--- a/src/winmain.c
+++ b/src/winmain.c
@@ -790,6 +790,13 @@ main(int argc, char *argv[])
   load_config(rc_file);
   delete(rc_file);
 
+  if (getenv("MINTTY_ROWS")) {
+    set_arg_option("Rows", getenv("MINTTY_ROWS"));
+  }
+  if (getenv("MINTTY_COLS")) {
+    set_arg_option("Columns", getenv("MINTTY_COLS"));
+  }
+
   for (;;) {
     int opt = getopt_long(argc, argv, short_opts, opts, 0);
     if (opt == -1 || opt == 'e')
diff --git a/wiki/Changelog.md b/wiki/Changelog.md
index 7ed30e0..d02d132 100644
--- a/wiki/Changelog.md
+++ b/wiki/Changelog.md
@@ -1,3 +1,6 @@
+### 2.0.2 (5 July 2015) ###
+  * Hotfix Alt-F2.
+
 ### 2.0.1 (1 July 2015) ###
 Display:
   * Fixed bold display by overstriking if BoldAsFont unset.
diff --git a/src/appinfo.h b/src/appinfo.h
index 73834e5..e3344d6 100644
--- a/src/appinfo.h
+++ b/src/appinfo.h
@@ -6,7 +6,7 @@
 
 #define MAJOR_VERSION  2
 #define MINOR_VERSION  0
-#define PATCH_NUMBER   1
+#define PATCH_NUMBER   2
 #define BUILD_NUMBER   0
 
 // needed for res.rc
